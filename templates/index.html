<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyFour</title>
    <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSfHpMcC4daqrDBNG72KOoGGfU9JfXo1V8BXa7cMNwQmQdKMy9kzslzdPU&s">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<main class="dashboard">
    <section class="card header">
        <div class="header-left">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSfHpMcC4daqrDBNG72KOoGGfU9JfXo1V8BXa7cMNwQmQdKMy9kzslzdPU&s" alt="DailyFour Logo" class="logo">
            <h1 class="title">DailyFour</h1>
        </div>
        <div class="header-right">
            <span id="notification-status-badge" class="badge hidden" title="Notification Status"></span>
            <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                <span id="theme-icon" class="theme-icon theme-icon-moon" data-icon="moon" aria-hidden="true"></span>
            </button>
            <nav class="tabs" aria-label="Dashboard sections">
                <button id="live-tab" class="tab active" data-tab="live" role="tab" aria-selected="true" aria-controls="tab-live" tabindex="0">Live</button>
                <button id="today-tab" class="tab" data-tab="today" role="tab" aria-selected="false" aria-controls="tab-today" tabindex="-1">Today</button>
                <button id="weekly-tab" class="tab" data-tab="weekly" role="tab" aria-selected="false" aria-controls="tab-weekly" tabindex="-1">Weekly</button>
                <button id="monthly-tab" class="tab" data-tab="monthly" role="tab" aria-selected="false" aria-controls="tab-monthly" tabindex="-1">Monthly</button>
            </nav>
        </div>
    </section>

    <div id="tab-live" class="tab-content" role="tabpanel" aria-labelledby="live-tab">
        <!-- Legacy connection status (hidden, kept for backward compatibility with tests) -->
        <section class="card legacy-status hidden">
            <div id="connection-status" class="status-line connected">
                <span class="status-dot" aria-hidden="true"></span>
                <span>
                    <span id="connection-label">Connected to</span>
                    <strong id="current-ssid">{{ office_wifi_name }}</strong>
                </span>
            </div>
            <p class="muted" id="session-started-at">Started at <span id="start-time">--:--:--</span></p>
        </section>

        <!-- Status Cards Grid (Task 7.2) -->
        <div class="status-cards-grid">
            <!-- Card 1: Connection Status -->
            <section class="status-card" id="card-connection">
                <div class="status-card-content">
                    <div class="status-card-label">Connection</div>
                    <div id="card-connection-value" class="status-card-value">Connected</div>
                    <div id="card-connection-detail" class="status-card-detail">{{ office_wifi_name }}</div>
                </div>
            </section>

            <!-- Card 2: Free At (When you can leave) -->
            <section class="status-card" id="card-free-at">
                <div class="status-card-content">
                    <div class="status-card-label">Free At</div>
                    <div id="card-free-at-value" class="status-card-value">--:--:--</div>
                    <div id="card-free-at-detail" class="status-card-detail">Target completion time</div>
                </div>
            </section>

            <!-- Card 3: Today's Total -->
            <section class="status-card" id="card-today">
                <div class="status-card-content">
                    <div class="status-card-label">Today's Total</div>
                    <div id="card-today-value" class="status-card-value">0h 00m</div>
                    <div id="card-today-detail" class="status-card-detail">0 sessions</div>
                </div>
            </section>

            <!-- Card 4: Time Remaining -->
            <section class="status-card" id="card-remaining">
                <div class="status-card-content">
                    <div class="status-card-label">Remaining</div>
                    <div id="card-remaining-value" class="status-card-value">00:00:00</div>
                    <div id="card-remaining-detail" class="status-card-detail">Until target</div>
                </div>
            </section>
        </div>

        <p id="sync-status" class="muted sync-status hidden" aria-live="polite"></p>

        <!-- Timer Display Section -->
        <section class="card timer-section">
            <p class="muted" id="timer-mode-label">Session Progress</p>
            <div class="timer-ring-layout">
                <div class="timer-ring-wrap">
                    <svg class="progress-ring" viewBox="0 0 220 220" aria-hidden="true" focusable="false">
                        <circle class="progress-ring-track" cx="110" cy="110" r="96"></circle>
                        <circle id="progress-ring-fill" class="progress-ring-fill" cx="110" cy="110" r="96"></circle>
                    </svg>
                    <div id="elapsed-display" class="elapsed-display">
                        <span id="elapsed-time">00:00:00</span>
                        <span class="elapsed-target">
                            <span class="elapsed-separator">/</span>
                            <span id="target-display">{{ target_display }}</span>
                        </span>
                        <span id="elapsed-percent" class="elapsed-percent">(0%)</span>
                    </div>
                </div>
            </div>
            <div class="progress-wrap">
                <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
            </div>
            <div class="countdown-section">
                <span class="countdown-label">Countdown:</span>
                <span id="timer-display" class="timer-countdown" aria-live="polite" aria-atomic="true">00:00:00</span>
            </div>
            <div class="free-at-section">
                <span id="free-at-label" class="free-at-label">You can leave at (IST):</span>
                <span id="free-at-time" class="free-at-time">--:--:-- -- IST</span>
            </div>
            <!-- Screen reader announcement for timer milestones --><div id="timer-announcements" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
            <!-- Task 7.5: Contextual Insights & Messaging -->
            <p id="contextual-message" class="contextual-message"></p>
            <p id="completion-banner" class="completion hidden">Completed! Total: <span id="completed-total">00:00:00</span></p>
        </section>
    </div>

    <div id="tab-today" class="tab-content hidden" role="tabpanel" aria-labelledby="today-tab">
        <section class="card">
            <h2>Today's Sessions</h2>
            <table id="today-sessions-table" aria-label="Today's sessions">
                <thead>
                <tr>
                    <th>Start</th>
                    <th>End</th>
                    <th>Duration</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="today-sessions-body">
                <tr>
                    <td colspan="4">No sessions for today.</td>
                </tr>
                </tbody>
            </table>
            <p class="total">Total: <span id="today-total-display">0h 00m</span></p>
        </section>
    </div>

    <div id="tab-weekly" class="tab-content hidden" role="tabpanel" aria-labelledby="weekly-tab">
        <section class="card">
            <div class="section-header">
                <h2>Weekly Analytics</h2>
                <div class="selector">
                    <button id="prev-week" class="btn-secondary" aria-label="Previous week">&larr;</button>
                    <span id="current-week-label" aria-live="polite">YYYY-Www</span>
                    <button id="next-week" class="btn-secondary" aria-label="Next week">&rarr;</button>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="weekly-chart"></canvas>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-label">Total Hours</span>
                    <span id="weekly-total-hours" class="stat-value">0h 00m</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Daily Avg (Office Days)</span>
                    <span id="weekly-avg-hours" class="stat-value">0h 00m</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Days in Office</span>
                    <span id="weekly-targets-met" class="stat-value">0 / 3 days</span>
                </div>
            </div>

            <table id="weekly-table" class="mt-16">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Day</th>
                    <th>Hours</th>
                    <th>Sessions</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="weekly-table-body">
                </tbody>
            </table>
        </section>
    </div>

    <div id="tab-monthly" class="tab-content hidden" role="tabpanel" aria-labelledby="monthly-tab">
        <section class="card">
            <div class="section-header">
                <h2>Monthly Analytics</h2>
                <div class="selector">
                    <button id="prev-month" class="btn-secondary" aria-label="Previous month">&larr;</button>
                    <span id="current-month-label" aria-live="polite">YYYY-MM</span>
                    <button id="next-month" class="btn-secondary" aria-label="Next month">&rarr;</button>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="monthly-chart"></canvas>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-label">Total Hours</span>
                    <span id="monthly-total-hours" class="stat-value">0h 00m</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Days Present</span>
                    <span id="monthly-total-days" class="stat-value">0</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Daily Avg (Office Days)</span>
                    <span id="monthly-avg-hours" class="stat-value">0h 00m</span>
                </div>
            </div>

            <table id="monthly-table" class="mt-16">
                <thead>
                <tr>
                    <th>Week</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Hours</th>
                    <th>Days</th>
                    <th>Avg</th>
                </tr>
                </thead>
                <tbody id="monthly-table-body">
                </tbody>
            </table>
        </section>
    </div>
</main>
<script>window.OFFICE_WIFI_NAME = "{{ office_wifi_name }}";</script>
<script src="/static/app.js" defer></script>
</body>
</html>
